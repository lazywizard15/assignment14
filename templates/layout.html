<!DOCTYPE html>
<html lang="en" class="h-full antialiased bg-gray-50">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Calculations App{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A powerful app for performing and storing calculations">
  
  <link rel="icon" href="{{ url_for('static', path='img/favicon.ico') }}" type="image/x-icon">
  
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Outfit:wght@500;700&display=swap" rel="stylesheet">

  <style>
    /* Modern Font Stack */
    body { font-family: 'Inter', sans-serif; }
    h1, h2, h3, h4, h5, h6, .brand-font { font-family: 'Outfit', sans-serif; }
    
    /* Smooth Scrolling */
    html { scroll-behavior: smooth; }
  </style>

  {% block head %}{% endblock %}
</head>

<body class="flex flex-col min-h-screen text-slate-800">

  <header class="sticky top-0 z-50 w-full shadow-lg bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-600 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        
        <div class="flex items-center">
          <a id="brandLink" href="{{ url_for('read_index') }}" class="group flex items-center space-x-3 transition-transform hover:scale-105">
            <div class="bg-white/20 backdrop-blur-sm rounded-xl p-2 border border-white/30 shadow-inner">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
              </svg>
            </div>
            <span class="text-xl font-bold tracking-wide brand-font text-white drop-shadow-md">
              Calc<span class="text-blue-200">App</span>
            </span>
          </a>
        </div>
  
        <div class="flex items-center space-x-6">
          <span id="layoutUserWelcome" class="text-sm font-medium text-blue-100 hidden md:block bg-white/10 px-3 py-1 rounded-full border border-white/10"></span>
          
          <button id="layoutLogoutBtn" class="hidden group relative inline-flex items-center justify-center rounded-lg bg-white/10 px-4 py-2 text-sm font-medium text-white hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-indigo-600 transition-all">
            <svg class="w-4 h-4 mr-2 opacity-80" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <span>Log out</span>
          </button>
        </div>

      </div>
    </div>
  </header>

  <main class="flex-grow w-full relative">
    <div class="absolute inset-0 -z-10 h-full w-full bg-white bg-[radial-gradient(#e5e7eb_1px,transparent_1px)] [background-size:16px_16px] opacity-50"></div>
    
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-slate-900 text-slate-400 mt-auto border-t border-slate-800">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
      <div class="md:flex md:items-center md:justify-between">
        
        <div class="flex justify-center space-x-8 md:order-2">
          <a href="#" class="hover:text-white transition-colors duration-200">GitHub</a>
          <a href="#" class="hover:text-white transition-colors duration-200">Docs</a>
          <a href="#" class="hover:text-white transition-colors duration-200">Support</a>
        </div>

        <div class="mt-8 md:mt-0 md:order-1">
          <p class="text-center text-sm">
            &copy; 2025 Calculations App. Crafted with <span class="text-red-500">â™¥</span> for IS601.
          </p>
        </div>
      </div>
    </div>
  </footer>

  <div id="toastContainer" class="fixed bottom-6 right-6 z-50 flex flex-col gap-3 pointer-events-none"></div>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // 1. Auth & Links
    const brandLink = document.getElementById('brandLink');
    if (brandLink) {
      const token = localStorage.getItem('access_token');
      if (token) brandLink.href = '/dashboard';
    }

    // 2. Welcome Message
    const welcomeElement = document.getElementById('layoutUserWelcome');
    if (welcomeElement) {
      const username = localStorage.getItem('username');
      if (username) {
        welcomeElement.textContent = `Hi, ${username}`;
        welcomeElement.classList.remove('hidden');
      } else {
        welcomeElement.classList.add('hidden');
      }
    }

    // 3. Logout
    const logoutBtn = document.getElementById('layoutLogoutBtn');
    if (logoutBtn) {
      const token = localStorage.getItem('access_token');
      if (!token) {
        logoutBtn.classList.add('hidden');
      } else {
        logoutBtn.classList.remove('hidden');
        logoutBtn.addEventListener('click', function() {
          if (confirm('Ready to leave?')) {
            localStorage.clear();
            showToast('Logged out successfully', 'success');
            setTimeout(() => { window.location.href = '/login'; }, 500);
          }
        });
      }
    }

    // 4. Toast Logic
    window.showToast = function(message, type = 'info', duration = 4000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      
      const styles = {
        success: { bg: 'bg-emerald-500', icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>' },
        error:   { bg: 'bg-rose-500',    icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>' },
        info:    { bg: 'bg-blue-500',    icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>' }
      };
      
      const style = styles[type] || styles.info;

      toast.className = `pointer-events-auto flex items-center w-full max-w-sm overflow-hidden ${style.bg} text-white shadow-xl rounded-lg transform transition-all duration-300 ease-out translate-x-full opacity-0`;
      toast.innerHTML = `
        <div class="p-4 flex items-center w-full">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">${style.icon}</svg>
          </div>
          <div class="ml-3 w-0 flex-1 pt-0.5">
            <p class="text-sm font-medium leading-5">${message}</p>
          </div>
          <button class="ml-4 flex-shrink-0 text-white/80 hover:text-white focus:outline-none">
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
          </button>
        </div>
      `;

      container.appendChild(toast);
      
      requestAnimationFrame(() => {
        toast.classList.remove('translate-x-full', 'opacity-0');
      });

      const remove = () => {
        toast.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => toast.remove(), 300);
      };

      toast.querySelector('button').addEventListener('click', remove);
      setTimeout(remove, duration);
    };
  });
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>